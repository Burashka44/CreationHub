services:
  creationhub:
    build: 
      context: .
      args:
        - VITE_SUPABASE_URL=/api/v1
        - VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoicG9zdGdyZXMiLCJleHAiOjIwODE2NzIxNTF9.-gu0krXvHDXGb2LVREvlEg43hO6BHZ2Vjb9mTS-BGLk
    container_name: creationhub
    ports:
      - "7777:80"
    restart: always
    environment:
      - VITE_SUPABASE_URL=/api/v1
      - VITE_SUPABASE_ANON_KEY=my-secret-anon-key
    networks:
      - default
      - creationhub-backend

  postgrest:
    image: postgrest/postgrest
    container_name: creationhub_api
    ports:
      - "7778:3000"
    environment:
      PGRST_DB_URI: "postgres://postgres:Tarantul1310@creationhub-postgres:5432/postgres"
      PGRST_DB_SCHEMA: public
      PGRST_DB_ANON_ROLE: postgres
    restart: always
    networks:
      - default
      - creationhub-backend

  stats-recorder:
    build: ./stats-recorder
    container_name: creationhub_stats
    restart: always
    environment:
      - DATABASE_URL=postgres://postgres:Tarantul1310@creationhub-postgres:5432/postgres
      - GLANCES_URL=http://192.168.1.220:61208/api/4
    networks:
      - default
      - creationhub-backend

  system-api:
    build: ./system-api
    container_name: creationhub_system_api
    restart: always
    ports:
      - "9191:9191"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /etc:/host-etc:ro
    networks:
      - default
      - creationhub-backend

  ollama:
    image: ollama/ollama:latest
    container_name: creationhub_ollama
    restart: always
    ports:
      - "11434:11434"
    volumes:
      - ${AI_DATA_PATH:-./ai_data}:/root/.ollama

networks:
  creationhub-backend:
    external: true


# üóÑÔ∏è DATABASE AUDIT REPORT

**–î–∞—Ç–∞:** 2026-01-11 12:55  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ù–ê–ô–î–ï–ù–´ –ü–†–û–ë–õ–ï–ú–´**

---

## üìä **–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•**

### **–†–∞–∑–º–µ—Ä –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–∞–±–ª–∏—Ü:**

| –¢–∞–±–ª–∏—Ü–∞ | –°—Ç—Ä–æ–∫ | Dead Rows | –†–∞–∑–º–µ—Ä | –°—Ç–∞—Ç—É—Å |
|---------|-------|-----------|--------|--------|
| `system_metrics` | 31,760 | 0 | 4.8 MB | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞—è |
| `network_traffic` | 28,031 | 0 | 5.1 MB | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞—è |
| `disk_snapshots` | 4,900 | 0 | 1.2 MB | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞—è |
| `activity_logs` | 21 | 0 | 32 KB | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| `services` | 20 | 15 | 32 KB | ‚ö†Ô∏è Dead rows |
| `security_settings` | 1 | 0 | 32 KB | ‚úÖ OK |
| `backups` | 1 | 0 | 32 KB | ‚úÖ OK |
| **17 —Ç–∞–±–ª–∏—Ü** | **0 —Å—Ç—Ä–æ–∫** | - | **~400 KB** | ‚ö†Ô∏è **–ü–£–°–¢–´–ï** |

---

## üö® **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´**

### **1. ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ï –ó–ê–ü–†–û–°–´ –ö –ë–î (3 –º–µ—Å—Ç–∞)**

#### **–ü—Ä–æ–±–ª–µ–º–∞ A: activity_logs.created_at**
**–§–∞–π–ª:** `src/pages/SecurityPage.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 71, 79

**–û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```
ERROR: column activity_logs.created_at does not exist at character 151
```

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```sql
activity_logs:
  - timestamp (–Ω–µ created_at!)
```

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥:**
```typescript
.order('created_at', { ascending: false })  // ‚ùå
...
time: timeAgo(e.created_at)  // ‚ùå
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```typescript
.order('timestamp', { ascending: false })  // ‚úÖ
...
time: timeAgo(e.timestamp)  // ‚úÖ
```

---

#### **–ü—Ä–æ–±–ª–µ–º–∞ B: security_settings.setting_key**
**–§–∞–π–ª:** `src/pages/SecurityPage.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 111-112

**–û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```
ERROR: column security_settings.setting_key does not exist at character 31
```

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```sql
security_settings:
  - id, ufw_status, fail2ban_status, ssh_port
  - last_check_at, created_at, updated_at
  (–Ω–µ—Ç setting_key/setting_value!)
```

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥:**
```typescript
.select('setting_key, setting_value')
.eq('setting_key', 'realtime')
```

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—Ä–æ—Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π. –ù—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å:
```typescript
.select('ufw_status, fail2ban_status')
.order('created_at', { ascending: false })
.limit(1)
.single()
```

---

## ‚ö†Ô∏è **–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø**

### **2. ‚ö†Ô∏è –ü–£–°–¢–´–ï –¢–ê–ë–õ–ò–¶–´ (17 —à—Ç—É–∫)**

–°–ª–µ–¥—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã **–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—É—Å—Ç—ã–µ** –∏ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ:

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ) | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|-------------------------------|----------|
| `ai_requests` | AI Hub –∑–∞–ø—Ä–æ—Å—ã | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| `ad_clicks` | –†–µ–∫–ª–∞–º–∞ | –í–µ—Ä–æ—è—Ç–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - —É–¥–∞–ª–∏—Ç—å |
| `ad_purchases` | –†–µ–∫–ª–∞–º–∞ | –í–µ—Ä–æ—è—Ç–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - —É–¥–∞–ª–∏—Ç—å |
| `ad_sales` | –†–µ–∫–ª–∞–º–∞ | –í–µ—Ä–æ—è—Ç–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - —É–¥–∞–ª–∏—Ç—å |
| `admins` | –ê–¥–º–∏–Ω—ã | ‚ö†Ô∏è 8 dead rows - –Ω—É–∂–µ–Ω VACUUM |
| `app_settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| `channel_ad_rates` | –†–µ–∫–ª–∞–º–∞ | –£–¥–∞–ª–∏—Ç—å |
| `dns_configs` | DNS –∫–æ–Ω—Ñ–∏–≥–∏ | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| `firewall_rules` | Firewall | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UI, –Ω–æ –ø—É—Å—Ç–∞ |
| `media_channels` | –ú–µ–¥–∏–∞ | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| `monitored_hosts` | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| `service_uptime` | Uptime —Å–µ—Ä–≤–∏—Å–æ–≤ | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| `telegram_ads` | Telegram —Ä–µ–∫–ª–∞–º–∞ | –£–¥–∞–ª–∏—Ç—å |
| `telegram_bots` | Telegram –±–æ—Ç—ã | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| `vpn_profiles` | VPN | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**  
- –£–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–µ–∫–ª–∞–º–æ–π (8 tables ~150 KB)
- –ü—Ä–æ–≤–µ—Å—Ç–∏ VACUUM –Ω–∞ `admins` (8 dead rows)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω—É–∂–Ω—ã –ª–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—É—Å—Ç—ã–µ —Ç–∞–±–ª–∏—Ü—ã

---

### **3. ‚ö†Ô∏è DEAD ROWS –≤ services**

–¢–∞–±–ª–∏—Ü–∞ `services` –∏–º–µ–µ—Ç 15 dead rows –ø—Ä–∏ 20 –∂–∏–≤—ã—Ö.  
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç—å VACUUM.

---

## üîß **–ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô**

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö–†–ò–¢–ò–ß–ù–û (—Å–µ–π—á–∞—Å)**
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `activity_logs.created_at` ‚Üí `timestamp`
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ `security_settings`

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–ê–ñ–ù–û (—Å–µ–≥–æ–¥–Ω—è)**
3. ‚úÖ –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã (—Ä–µ–∫–ª–∞–º–∞)
4. ‚úÖ –ü—Ä–æ–≤–µ—Å—Ç–∏ VACUUM ANALYZE

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û (–Ω–∞ –Ω–µ–¥–µ–ª–µ)**
5. –†–µ—à–∏—Ç—å —Å—É–¥—å–±—É –ø—É—Å—Ç—ã—Ö —Ç–∞–±–ª–∏—Ü (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å)

---

## üìù **SQL –î–õ–Ø –û–ß–ò–°–¢–ö–ò**

```sql
-- 1. –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
DROP TABLE IF EXISTS ad_clicks CASCADE;
DROP TABLE IF EXISTS ad_purchases CASCADE;
DROP TABLE IF EXISTS ad_sales CASCADE;
DROP TABLE IF EXISTS channel_ad_rates CASCADE;
DROP TABLE IF EXISTS telegram_ads CASCADE;

-- 2. –û—á–∏—Å—Ç–∫–∞ dead rows
VACUUM ANALYZE admins;
VACUUM ANALYZE services;

-- 3. –ü–æ–ª–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î
VACUUM ANALYZE;
```

---

## ‚úÖ **–í–ï–†–î–ò–ö–¢**

**–ù–∞–π–¥–µ–Ω–æ:**
- ‚ùå 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–∞ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- ‚ö†Ô∏è 17 –ø—É—Å—Ç—ã—Ö —Ç–∞–±–ª–∏—Ü
- ‚ö†Ô∏è Dead rows –≤ 2 —Ç–∞–±–ª–∏—Ü–∞—Ö

**–í–ª–∏—è–Ω–∏–µ:**
- –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö PostgreSQL
- –ù–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (Security Page)
- –ù–µ–±–æ–ª—å—à–∞—è —Ç—Ä–∞—Ç–∞ –º–µ—Å—Ç–∞ (~500 KB)

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –æ—á–∏—Å—Ç–∏—Ç—å –ë–î.

---

**–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞:** 2026-01-11 12:55
